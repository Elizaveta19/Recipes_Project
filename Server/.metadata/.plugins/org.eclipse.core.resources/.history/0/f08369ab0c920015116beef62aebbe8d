import java.io.BufferedReader;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.io.PrintWriter;
import java.net.Socket;
import java.io.BufferedWriter;
import java.io.FileWriter;

public class ServerMain extends Thread {

		long n;
		String HostName;
		Socket socket;
		//BufferedReader in;
		//PrintWriter out;

		public ServerMain(Socket s, String HostName, long n) throws IOException {
		    this.n = n; //эта переменная получает по параметру № климента, который подключился
		    this.HostName = HostName;  //эта переменная получает по параметру имя климента, который подключился
		    this.socket = s;
		    //в этупеременную будутт поступать данные
		    //this.in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
		    //эта переменная на вывод данных клиенту
		    //this.out = new PrintWriter(new BufferedWriter(new OutputStreamWriter(socket.getOutputStream())), true);
		    start();
		}

		public void run() {
		    try {
		        while (true) {
		            
		        	
		        	/*String str = in.readLine();
		            if (str.equalsIgnoreCase("END")) {
		                    break;
		            }
		            int a=1+3; //разного рода вычесление
		            out.println("Я получил Ваши данные, вот то что Вы прислали: "+str);
		            out.println("Я выполнилась операцию: "+a);*/
		        	
		        	
		        	// Берем входной и выходной потоки сокета, теперь можем получать и отсылать данные клиенту. 
		            InputStream sin = socket.getInputStream();
		            OutputStream sout = socket.getOutputStream();

		            // Конвертируем потоки в другой тип, чтоб легче обрабатывать текстовые сообщения.
		            DataInputStream in = new DataInputStream(sin);
		            DataOutputStream out = new DataOutputStream(sout);

		            String line = null;
		            while(true) {
		              line = in.readUTF(); // ожидаем пока клиент пришлет строку текста.
		              System.out.println("The dumb client just sent me this line : " + line);
		              String line2 = "bbb";
		              System.out.println("I'm sending it back...");
		              out.writeUTF(line2); // отсылаем клиенту обратно ту самую строку текста.
		              out.flush(); // заставляем поток закончить передачу данных.
		              System.out.println("Waiting for the next line...");
		              System.out.println();
		            }
		        }
		    } catch (IOException e) {
		        System.err.println("Соединение № "+ n +". Ошибка при передачи клиенту: " +HostName);
		    } finally {
		        try {
		            socket.close();
		        } catch (IOException e) {
		            System.err.println("Соединение № "+ n +". Не получается разорвать связь с клиентом: " +HostName);
		        }
		    }
		    System.out.println("Завершено соединение № "+ n +", клиент: " +HostName+" отключен");

		}
}